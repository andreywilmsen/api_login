<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div>
        <h1>Logar e Autenticar</h1>
        <input id="email" type="text" placeholder="email">
        <input id="password" type="password" placeholder="senha">
        <button onclick="logar()" type="submit">Logar</button>
        <button onclick="autenticar()" type="submit">Autenticar</button>
    </div>
    <div>
        <h1>Editar</h1>

        <input id="name" type="text" placeholder="name">
        <input class="email" type="text" placeholder="email">
        <input id="oldPassword" type="password" placeholder="oldPassword">
        <input id="newPassword" type="password" placeholder="newPassword">
        <input id="confirmNewPassword" type="password" placeholder="confirmNewPassword">
        <button onclick="editar()" type="submit">Editar</button>
    </div>

    <div>
        <h1>Registrar</h1>

        <input id="registerName" type="text" placeholder="name">
        <input id="registerEmail" type="text" placeholder="email">
        <input id="registerPassword" type="password" placeholder="Password">
        <input id="confirmPassword" type="password" placeholder="confirmPassword">
        <button onclick="cadastrar()" type="submit">Cadastrar</button>
    </div>

    <script>
        function logar() {
            localStorage.clear();

            let email = (document.getElementById('email')).value;
            let password = (document.getElementById('password')).value;

            fetch('http://localhost:8080/login', {
                method: 'POST',
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password })
            }).then(res => {
                console.log(res);
                return res.json()
            }).then(json => {
                localStorage.setItem("token", json.data)
            }).catch(err => {
                console.log(err);
            })
        }
        function autenticar() {
            let token = localStorage.getItem("token");
            fetch('http://localhost:8080/auth', {
                headers: { "Authorization-Token": token }
            }).then(res => {
                return res.json()
            }).then(json => {
                if (json.status === "success") {
                    console.log("Usuário autenticado")
                }
            }).catch(err => {
                console.log(err);
            })
        }
        function editar() {
            let token = localStorage.getItem("token");
            let name = (document.getElementById('name')).value;
            let email = (document.getElementsByClassName('email')[0]).value;
            let oldPassword = (document.getElementById('oldPassword')).value;
            let newPassword = (document.getElementById('newPassword')).value;
            let confirmNewPassword = (document.getElementById('confirmNewPassword')).value;

            fetch('http://localhost:8080/edit', {
                method: 'PUT',
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ token, name, email, oldPassword, newPassword, confirmNewPassword })
            }).then(res => {
                return res.json()
            }).then(json => {
                console.log("Cadastro editado com sucesso!")
            }).catch(err => {
                console.log(err);
            })
        }

        function cadastrar() {
            let name = (document.getElementById('registerName')).value;
            let email = (document.getElementById('registerEmail')).value;
            let password = (document.getElementById('registerPassword')).value;
            let confirmPassword = (document.getElementById('confirmPassword')).value;

            fetch('http://localhost:8080/register', {
                method: 'POST',
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name, email, password, confirmPassword })
            }).then(res => {
                return res.json()
            }).then(json => {
                if (json.status = "success") {
                    console.log("Usuário cadastrado com sucesso!")
                }
            }).catch(err => {
                console.log(err);
            })
        }

    </script>
</body>

</html>